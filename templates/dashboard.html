
{% extends 'layout.html' %}

{% block content %}
<div class="container my-4">
  <h4>Dashboard</h4>

<!-- ===================== KPIs ===================== -->
<div class="kpi-grid">
  <!-- Linha 1 -->
  <div class="kpi-card kpi-quantidade">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Recargas"
          data-bs-content="Quantidade de recargas registradas no período.">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-bolt"></i>
    <h6>Recargas</h6>
    <p>{{ kpis.recargas | brl(0, False) }}</p>
  </div>

  <div class="kpi-card kpi-quantidade">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Recargas Isentas"
          data-bs-content="Recargas gratuitas (isento = TRUE).">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-gift"></i>
    <h6>Recargas Isentas</h6>
    <p>{{ kpis.recargas_isentas_qtd | brl(0, False) }}</p>
  </div>

  <div class="kpi-card kpi-quantidade">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Recargas Pagas"
          data-bs-content="Recargas pagas (isento = FALSE).">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-credit-card"></i>
    <h6>Recargas Pagas</h6>
    <p>{{ kpis.recargas_pagas_qtd | brl(0, False) }}</p>
  </div>

  <div class="kpi-card kpi-quantidade">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Km Rodados"
          data-bs-content="Diferença entre o último e o primeiro odômetro no período.">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-road"></i>
    <h6>Km Rodados</h6>
    <p>{{ kpis.total_km | brl(0, False) }} km</p>
  </div>

  <!-- Linha 2 -->
  <div class="kpi-card kpi-consumo">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Consumo / 100Km"
          data-bs-content="Somatório de kWh ÷ Total de km × 100.">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-tachometer-alt"></i>
    <h6>Consumo / 100Km</h6>
    <p>{{ kpis.consumo_por_100km | brl(2, False) }} kWh</p>
  </div>

  <div class="kpi-card kpi-custo">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Custo Médio / kWh"
          data-bs-content="Custo total ÷ kWh total.">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-battery-half"></i>
    <h6>Custo Médio / kWh</h6>
    <p>{{ kpis.custo_medio_kwh | brl(3) }}</p>
  </div>

  <div class="kpi-card kpi-custo">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Custo Médio / Km"
          data-bs-content="Custo total ÷ km rodados.">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-ruler-horizontal"></i>
    <h6>Custo Médio / Km</h6>
    <p>{{ kpis.custo_medio_km | brl(3) }}</p>
  </div>

  <div class="kpi-card kpi-custo">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Custo Gasolina / Km"
          data-bs-content="Preço da gasolina ÷ consumo (km/l).">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-gas-pump"></i>
    <h6>Custo Gasolina / Km</h6>
    <p>{{ kpis.custo_gas_por_km | brl(3) }}</p>
  </div>

  <!-- Linha 3 -->
  <div class="kpi-card kpi-custo">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Custo Total"
          data-bs-content="Somatório dos custos (inclui isentas).">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-wallet"></i>
    <h6>Custo Total</h6>
    <p>{{ kpis.custo_total | brl(2) }}</p>
  </div>

  <div class="kpi-card kpi-custo">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Recargas Isentas (R$)"
          data-bs-content="Somatório do custo com isento = TRUE.">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-gift"></i>
    <h6>Recargas Isentas (R$)</h6>
    <p>{{ kpis.custo_isentas | brl(2) }}</p>
  </div>

  <div class="kpi-card kpi-custo">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Recargas Pagas (R$)"
          data-bs-content="Somatório do custo com isento = FALSE.">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-credit-card"></i>
    <h6>Recargas Pagas (R$)</h6>
    <p>{{ kpis.custo_pagas | brl(2) }}</p>
  </div>

  <div class="kpi-card kpi-consumo">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Consumo Total"
          data-bs-content="Somatório de kWh (isentas e pagas).">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-battery-full"></i>
    <h6>Consumo Total</h6>
    <p>{{ kpis.consumo_total_kwh | brl(2, False) }} kWh</p>
  </div>

  <!-- Linha 4 -->
  <div class="kpi-card kpi-economia">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Economia (Custo)"
          data-bs-content="Custo simulado da gasolina − Custo total.">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-piggy-bank"></i>
    <h6>Economia (Custo)</h6>
    <p>{{ kpis.economia_total | brl(2) }}</p>
  </div>

  <div class="kpi-card kpi-economia">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Economia (Custo) / Km"
          data-bs-content="Economia total ÷ km rodados.">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-chart-line"></i>
    <h6>Economia (Custo) / Km</h6>
    <p>{{ kpis.economia_total_por_km | brl(3) }}</p>
  </div>

  <div class="kpi-card kpi-economia">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Economia (Pagas)"
          data-bs-content="Custo simulado da gasolina − Custo das recargas pagas.">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-hand-holding-usd"></i>
    <h6>Economia (Pagas)</h6>
    <p>{{ kpis.economia_pagas | brl(2) }}</p>
  </div>

  <div class="kpi-card kpi-economia">
    <span class="kpi-info" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-placement="top" title="Economia (Pagas) / Km"
          data-bs-content="Economia (pagas) ÷ km rodados.">
      <i class="fas fa-info-circle"></i>
    </span>
    <i class="fas fa-chart-bar"></i>
    <h6>Economia (Pagas) / Km</h6>
    <p>{{ kpis.economia_pagas_por_km | brl(3) }}</p>
  </div>
</div>

  <!-- ===================== GRÁFICOS ===================== -->
  <div class="dashboard-charts">
    <div class="chart-card"><h6>Custos por Mês</h6><div class="chart-container"><canvas id="chartCustos"></canvas></div></div>
    <div class="chart-card"><h6>Valores Economizados por Mês</h6><div class="chart-container"><canvas id="chartEconomia"></canvas></div></div>
    <div class="chart-card"><h6>Consumo por Mês (kWh)</h6><div class="chart-container"><canvas id="chartConsumo"></canvas></div></div>
    <div class="chart-card"><h6>Km Rodados por Mês</h6><div class="chart-container"><canvas id="chartKm"></canvas></div></div>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
{% include 'partials/dashboard_charts.js' %}
</script>
{% endblock %}
